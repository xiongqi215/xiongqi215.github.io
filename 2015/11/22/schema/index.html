<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> Solr-Schema.xml配置 · 非典型性程序猿</title><meta name="description" content="Solr-Schema.xml配置 - Justin"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="short icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://www.justin-x.cn/atom.xml" title="非典型性程序猿"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="http://weibo.com/justin890215" target="_blank" class="nav-list-link">WEIBO</a></li><li class="nav-list-item"><a href="https://github.com/xiongqi215" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><section class="container"><div class="post"><article class="post-block"><h1 class="post-title">Solr-Schema.xml配置</h1><div class="post-info">Nov 22, 2015</div><div class="post-content"><p>schema.xml位于core目录/conf/目录下，用于配置该core中的字段即字段类型，处理、分析方式。主要包括<code>&lt;schema &gt;</code>根节点，<code>&lt;field&gt;</code>字段定义以及<code>&lt;fieldType&gt;</code>字段类型定义组成。</p>
<a id="more"></a>
<ul>
<li><p><strong>Schema根节点</strong>：<code>&lt;schema name=&quot;example&quot; version=&quot;1.2&quot;&gt;</code></p>
<ul>
<li>name：标识这个schema的名字</li>
<li>version：现在版本是1.2</li>
</ul>
</li>
</ul>
<ul>
<li><p><strong>Field字段定义</strong>:<code>&lt;field name=&quot;id&quot; type=&quot;string&quot; indexed=&quot;true&quot; stored=&quot;true&quot; required=&quot;true&quot; /&gt;</code></p>
<ul>
<li><p>name：字段名称。</p>
</li>
<li><p>type：字段类型对应<code>&lt;fieldType&gt;</code>中的定义。</p>
</li>
<li><p>indexed：是否被用来建立索引（关系到搜索和排序）<strong>如果该字段为主键，则indexed必须为true</strong></p>
</li>
<li><p>stored：是否储存</p>
</li>
<li><p>docValues: 如果这个字段应该有文档值（doc values），设置为true。文档值在门<br>面搜索，分组，排序和函数查询中会非常有用。虽然不是必须的，而且会导致生成<br>索引变大变慢，但这样设置会使索引加载更快，更加NRT友好，更高的内存使用效率。<br>然而也有一些使用限制：目前仅支持StrField, UUIDField和所有 Trie*Fields,<br>并且依赖字段类型, 可能要求字段为单值（single-valued）的,必须的或者有默认值。</p>
</li>
<li><p>required：是否必输</p>
</li>
<li><p>compressed：[false]，是否使用gzip压缩（只有TextField和StrField可以压缩）</p>
</li>
<li><p>mutiValued：是否包含多个值，可以理解为数组</p>
</li>
<li><p>default：如果没有属性需要修改，就可以用这个标识下。</p>
</li>
<li><p>omitNorms：是否忽略掉Norm，可以节省内存空间，只有全文本field和need an - index-time boost的field需要norm。（具体没看懂，注释里有矛盾）</p>
</li>
<li><p>termVectors：[false]，当设置true，会存储 term vector。当使用   MoreLikeThis，用来作为相似词的field应该存储起来。</p>
</li>
<li><p>termPositions：存储 term vector中的地址信息，会消耗存储开销。</p>
</li>
<li><p>termOffsets：存储 term vector 的偏移量，会消耗存储开销。</p>
</li>
</ul>
</li>
</ul>
<div class="alert alert-info" role="info"><br><code>omitNorms</code>,<code>termVectors</code>,<code>termPositions</code>,<code>termOffsets</code>还不太懂什么意思。<br></div>

<p><strong>着重解释下<code>indexed</code>与<code>stored</code>:</strong></p>
<p>   <strong>indexed表示需不需要建立索引，以便之后对这个field进行查询；</strong></p>
<p>   <strong>stored表示需不需要随索引同时存储这个field本身的内容，以便查询时直接从结果中获取该内容，一般大数据（比如文件内容本身）不会和索引一起保存，节省资源，防止索引过大。</strong> </p>
<p>官方文档(5.2)中的描述：</p>
<p><img src="http://i.imgur.com/BUvFSaY.png" alt=""><br><img src="http://i.imgur.com/mJy7VRx.png" alt=""></p>
<ul>
<li>FieldType 字段了定义：这个节点想对复杂。简单的可以按如下定义<br> <code>&lt;fieldType name=&quot;string&quot; class=&quot;solr.StrField&quot; sortMissingLast=&quot;true&quot; precisionStep=&quot;0&quot; positionIncrementGap=&quot;0&quot; /&gt;</code> </li>
</ul>
<ul>
<li><p>name：类型名称，对应<code>&lt;field&gt;</code>中<code>type=&#39;String&#39;</code></p>
</li>
<li><p>class：类型对应的处理java类，常用的基本类型有：   <code>solr.StrField</code>、<code>solr.BoolField</code>、<code>solr.TrieIntField</code>、<code>solr.TrieFloatField</code>、<code>solr.TrieLongField</code>、<code>solr.TrieDoubleField</code>、<code>solr.UUIDField</code></p>
</li>
<li><p>sortMissingLast和sortMissingFirst两个属性是用在可以内在使用String排序的类型上（包括：string,boolean,sint,slong,sfloat,sdouble,pdate）。<br>sortMissingLast=”true”，没有该field的数据排在有该field的数据之后，而不管请求时的排序规则。<br>sortMissingFirst=”true”，跟上面倒过来呗。</p>
</li>
</ul>
<p>  <strong><code>precisionStep</code>和<code>positionIncrementGap</code>还未理解是什么意思，但是可以知道的是,**</strong><code>positionIncrementGap</code>只对<code>mutiValued=ture</code>有意义。**</p>
<p>官方文档(5.2)中的描述：</p>
<p><img src="http://i.imgur.com/lwQxUuC.png" alt=""></p>
<p>solr自带数据类型(官方文档):</p>
<p><img src="http://i.imgur.com/kTLNaEe.png" alt=""><br><img src="http://i.imgur.com/8yawFbv.png" alt=""><br><img src="http://i.imgur.com/Dxm9a7l.png" alt=""><br><img src="http://i.imgur.com/Kzogdcl.png" alt=""></p>
<ul>
<li><p><strong>使用analyzer，tokenizer，filter自定义字段类型</strong></p>
</li>
<li><p>如下：定义了一个字段，使用中文分词器</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">fieldType</span> <span class="attr">name</span>=<span class="string">"text_general"</span> <span class="attr">class</span>=<span class="string">"solr.TextField"</span> <span class="attr">positionIncrementGap</span>=<span class="string">"100"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">analyzer</span> <span class="attr">type</span>=<span class="string">"index"</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">tokenizer</span> <span class="attr">class</span>=<span class="string">"solr.StandardTokenizerFactory"</span>/&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.StopFilterFactory"</span> <span class="attr">ignoreCase</span>=<span class="string">"true"</span> <span class="attr">words</span>=<span class="string">"stopwords.txt"</span> /&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.LowerCaseFilterFactory"</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">analyzer</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">analyzer</span> <span class="attr">type</span>=<span class="string">"query"</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">tokenizer</span> <span class="attr">class</span>=<span class="string">"solr.StandardTokenizerFactory"</span>/&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.StopFilterFactory"</span> <span class="attr">ignoreCase</span>=<span class="string">"true"</span> <span class="attr">words</span>=<span class="string">"stopwords.txt"</span> /&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.SynonymFilterFactory"</span> <span class="attr">synonyms</span>=<span class="string">"synonyms.txt"</span> <span class="attr">ignoreCase</span>=<span class="string">"true"</span> <span class="attr">expand</span>=<span class="string">"true"</span>/&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.LowerCaseFilterFactory"</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">analyzer</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">fieldType</span>&gt;</span></div></pre></td></tr></table></figure>
</li>
</ul>
<div class="alert alert-danger" role="alert"><br>  <ul><br>   <li>只用 solr.TextField 这种类型的字段可以使用自定义analyzer</li><br>   <li>tokenizer是分词器，其作用就将文本切分为一个个词语或单词</li><br>   <li>filter是过滤器，用于过滤到文本中不需要的成分，如英文中的a,the等介词或标点符号和空格。它们需要我们制定一个txt作为过滤的依据词典，如本例中的stopwords.txt和synonyms.txt</li><br></ul></div>


<ul>
<li><strong>其它标签</strong></li>
</ul>
<p>主键：<code>&lt;uniqueKey&gt;id&lt;/uniqueKey&gt;</code>定义文档主键使用的字段</p>
<p>保留字段: <code>_version_</code>为保留字段，不得删除，每个schema中都必须有。实际上name前后带有_的字段都为保留字段。<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">field</span> <span class="attr">name</span>=<span class="string">"_version_"</span> <span class="attr">type</span>=<span class="string">"long"</span> <span class="attr">indexed</span>=<span class="string">"true"</span> <span class="attr">stored</span>=<span class="string">"true"</span>/&gt;</span></div></pre></td></tr></table></figure></p>
<p>一份简单的<code>schema.xml</code>:<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div></pre></td><td class="code"><pre><div class="line"> </div><div class="line">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</div><div class="line">  <span class="tag">&lt;<span class="name">schema</span> <span class="attr">name</span>=<span class="string">"sjsmhp"</span> <span class="attr">version</span>=<span class="string">"1.5"</span>&gt;</span></div><div class="line">   <span class="tag">&lt;<span class="name">uniqueKey</span>&gt;</span>id<span class="tag">&lt;/<span class="name">uniqueKey</span>&gt;</span></div><div class="line">   <span class="tag">&lt;<span class="name">field</span> <span class="attr">name</span>=<span class="string">"id"</span> <span class="attr">type</span>=<span class="string">"long"</span> <span class="attr">indexed</span>=<span class="string">"true"</span> <span class="attr">stored</span>=<span class="string">"true"</span> <span class="attr">multiValued</span>=<span class="string">"false"</span> /&gt;</span> </div><div class="line">   <span class="tag">&lt;<span class="name">field</span> <span class="attr">name</span>=<span class="string">"name_cn"</span> <span class="attr">type</span>=<span class="string">"text_general"</span> <span class="attr">indexed</span>=<span class="string">"ture"</span> <span class="attr">stored</span>=<span class="string">"true"</span>  /&gt;</span>  </div><div class="line">   <span class="tag">&lt;<span class="name">field</span> <span class="attr">name</span>=<span class="string">"name_en"</span> <span class="attr">type</span>=<span class="string">"text_general"</span> <span class="attr">indexed</span>=<span class="string">"ture"</span> <span class="attr">stored</span>=<span class="string">"true"</span>  /&gt;</span>  </div><div class="line">   <span class="tag">&lt;<span class="name">field</span> <span class="attr">name</span>=<span class="string">"continents_cn"</span> <span class="attr">type</span>=<span class="string">"text_general"</span> <span class="attr">indexed</span>=<span class="string">"ture"</span> <span class="attr">stored</span>=<span class="string">"true"</span>  /&gt;</span>  </div><div class="line">   <span class="tag">&lt;<span class="name">field</span> <span class="attr">name</span>=<span class="string">"continents_en"</span> <span class="attr">type</span>=<span class="string">"text_general"</span> <span class="attr">indexed</span>=<span class="string">"ture"</span> <span class="attr">stored</span>=<span class="string">"true"</span>  /&gt;</span>  </div><div class="line">   <span class="tag">&lt;<span class="name">field</span> <span class="attr">name</span>=<span class="string">"en_first_letter"</span> <span class="attr">type</span>=<span class="string">"string"</span> <span class="attr">indexed</span>=<span class="string">"ture"</span> <span class="attr">stored</span>=<span class="string">"true"</span>  /&gt;</span> </div><div class="line">   <span class="tag">&lt;<span class="name">field</span> <span class="attr">name</span>=<span class="string">"cn_first_letter"</span> <span class="attr">type</span>=<span class="string">"string"</span> <span class="attr">indexed</span>=<span class="string">"ture"</span> <span class="attr">stored</span>=<span class="string">"true"</span>  /&gt;</span> </div><div class="line">   <span class="tag">&lt;<span class="name">field</span> <span class="attr">name</span>=<span class="string">"sort"</span> <span class="attr">type</span>=<span class="string">"int"</span> <span class="attr">indexed</span>=<span class="string">"ture"</span> <span class="attr">stored</span>=<span class="string">"false"</span>  /&gt;</span>  </div><div class="line">   <span class="tag">&lt;<span class="name">field</span> <span class="attr">name</span>=<span class="string">"_version_"</span> <span class="attr">type</span>=<span class="string">"long"</span> <span class="attr">indexed</span>=<span class="string">"true"</span> <span class="attr">stored</span>=<span class="string">"true"</span>/&gt;</span></div><div class="line">   <span class="tag">&lt;<span class="name">field</span> <span class="attr">name</span>=<span class="string">"_root_"</span> <span class="attr">type</span>=<span class="string">"string"</span> <span class="attr">indexed</span>=<span class="string">"false"</span> <span class="attr">stored</span>=<span class="string">"false"</span>/&gt;</span></div><div class="line"></div><div class="line">   <span class="tag">&lt;<span class="name">fieldType</span> <span class="attr">name</span>=<span class="string">"string"</span> <span class="attr">class</span>=<span class="string">"solr.StrField"</span> <span class="attr">sortMissingLast</span>=<span class="string">"true"</span> /&gt;</span></div><div class="line">   <span class="tag">&lt;<span class="name">fieldType</span> <span class="attr">name</span>=<span class="string">"boolean"</span> <span class="attr">class</span>=<span class="string">"solr.BoolField"</span> <span class="attr">sortMissingLast</span>=<span class="string">"true"</span>/&gt;</span></div><div class="line">   <span class="tag">&lt;<span class="name">fieldType</span> <span class="attr">name</span>=<span class="string">"int"</span> <span class="attr">class</span>=<span class="string">"solr.TrieIntField"</span> <span class="attr">precisionStep</span>=<span class="string">"0"</span> <span class="attr">positionIncrementGap</span>=<span class="string">"0"</span>/&gt;</span></div><div class="line">   <span class="tag">&lt;<span class="name">fieldType</span> <span class="attr">name</span>=<span class="string">"float"</span> <span class="attr">class</span>=<span class="string">"solr.TrieFloatField"</span> <span class="attr">precisionStep</span>=<span class="string">"0"</span> <span class="attr">positionIncrementGap</span>=<span class="string">"0"</span>/&gt;</span></div><div class="line">   <span class="tag">&lt;<span class="name">fieldType</span> <span class="attr">name</span>=<span class="string">"long"</span> <span class="attr">class</span>=<span class="string">"solr.TrieLongField"</span> <span class="attr">precisionStep</span>=<span class="string">"0"</span> <span class="attr">positionIncrementGap</span>=<span class="string">"0"</span>/&gt;</span></div><div class="line">   <span class="tag">&lt;<span class="name">fieldType</span> <span class="attr">name</span>=<span class="string">"double"</span> <span class="attr">class</span>=<span class="string">"solr.TrieDoubleField"</span> <span class="attr">precisionStep</span>=<span class="string">"0"</span> <span class="attr">positionIncrementGap</span>=<span class="string">"0"</span>/&gt;</span></div><div class="line"></div><div class="line"><span class="comment">&lt;!--中英文分词--&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">fieldType</span> <span class="attr">name</span>=<span class="string">"text_general"</span> <span class="attr">class</span>=<span class="string">"solr.TextField"</span> <span class="attr">positionIncrementGap</span>=<span class="string">"100"</span>&gt;</span></div><div class="line"></div><div class="line">  <span class="tag">&lt;<span class="name">analyzer</span> <span class="attr">type</span>=<span class="string">"index"</span>&gt;</span></div><div class="line">     <span class="tag">&lt;<span class="name">tokenizer</span> <span class="attr">class</span>=<span class="string">"solr.StandardTokenizerFactory"</span>/&gt;</span></div><div class="line">     <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.StopFilterFactory"</span> <span class="attr">ignoreCase</span>=<span class="string">"true"</span> <span class="attr">words</span>=<span class="string">"stopwords.txt"</span> /&gt;</span></div><div class="line">     <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.LowerCaseFilterFactory"</span>/&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">analyzer</span>&gt;</span></div><div class="line"></div><div class="line">  <span class="tag">&lt;<span class="name">analyzer</span> <span class="attr">type</span>=<span class="string">"query"</span>&gt;</span></div><div class="line">	   <span class="tag">&lt;<span class="name">tokenizer</span> <span class="attr">class</span>=<span class="string">"solr.StandardTokenizerFactory"</span>/&gt;</span></div><div class="line">	   <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.StopFilterFactory"</span> <span class="attr">ignoreCase</span>=<span class="string">"true"</span> <span class="attr">words</span>=<span class="string">"stopwords.txt"</span> /&gt;</span></div><div class="line">	   <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.SynonymFilterFactory"</span> <span class="attr">synonyms</span>=<span class="string">"synonyms.txt"</span> <span class="attr">ignoreCase</span>=<span class="string">"true"</span> <span class="attr">expand</span>=<span class="string">"true"</span>/&gt;</span></div><div class="line">	   <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.LowerCaseFilterFactory"</span>/&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">analyzer</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">fieldType</span>&gt;</span></div><div class="line"></div><div class="line">  </div><div class="line">   <span class="tag">&lt;<span class="name">fieldType</span> <span class="attr">name</span>=<span class="string">"uuid"</span> <span class="attr">class</span>=<span class="string">"solr.UUIDField"</span> <span class="attr">indexed</span>=<span class="string">"false"</span> /&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">schema</span>&gt;</span></div></pre></td></tr></table></figure></p>
</div></article></div></section><footer><div class="paginator"><a href="/2015/11/22/solr-intro/" class="prev">上一篇</a><a href="/2015/09/21/oracle-11g_exp_empty_table/" class="next">下一篇</a></div><div data-thread-key="2015/11/22/schema/" data-title="Solr-Schema.xml配置" data-url="http://www.justin-x.cn/2015/11/22/schema/" data-author-key="1" class="ds-thread"></div><script>var duoshuoQuery = {short_name:"Justin-Blog"};
(function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] 
     || document.getElementsByTagName('body')[0]).appendChild(ds);
})();

</script><div class="copyright"><p><script>var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");document.write(unescape("%3Cspan id='cnzz_stat_icon_1260236137'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s11.cnzz.com/z_stat.php%3Fid%3D1260236137%26show%3Dpic' type='text/javascript'%3E%3C/script%3E")); </script>© 2015 - 2016 <a href="http://www.justin-x.cn">Justin</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a></p></div><script>(function(){
var bp = document.createElement('script');
var curProtocol = window.location.protocol.split(':')[0];
if (curProtocol === 'https') {
   bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
}
else {
   bp.src = 'http://push.zhanzhang.baidu.com/push.js';
}
var s = document.getElementsByTagName("script")[0];
s.parentNode.insertBefore(bp, s);
})();</script></footer></div><script async src="//cdn.bootcss.com/mathjax/2.6.1/MathJax.js?config=TeX-MML-AM_CHTML"></script></body></html>